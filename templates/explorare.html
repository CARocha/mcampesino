{% extends "base.html"%}
{%block extra%}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="{{STATIC_URL}}js/custom.js"></script>
<script src="{{STATIC_URL}}js/jquery.cookie.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $('#explora').addClass("seleccionado");
    });
//empieza el mapa 
 function myMapa(value) {

      var mapOptions = {
        center: new google.maps.LatLng(12.877, -85.001),
        zoom: 7,
        mapTypeId: google.maps.MapTypeId.TERRAIN
      }

        var map = new google.maps.Map(document.getElementById('map'),
        mapOptions);

        var depart = value;
        //comineza para mostrar mapa
        $.post('/ver_mapa/',{depart:depart}, function(data){
                console.log(data)
                $.each(data, function(i, elemento){
                    var latlng = new google.maps.LatLng(elemento.lat, elemento.lon);
                    var marker = new google.maps.Marker({
                        position: latlng,
                        map: map,
                        name: elemento.nombre,
                        desc: elemento.periodicidad,
                        icon: '/files/img/fruits.png' 
                    });
                    google.maps.event.addListener(marker, "click", function() {
                     var html = '<b>' + elemento.nombre + 
                                '</b><br>' + elemento.periodicidad + 
                                '<br>' + elemento.modalidad +
                                '<br>';
                        infowindow = new google.maps.InfoWindow({
                                content: html,
                                zIndex: 999,
                            });
                        infowindow.open(map, this);
                    });
                });
        });


               
} // fin de la funcion myMapa
//termina el mapa

</script>

{%endblock%}
{%block content%}
    <section class="titulo interna">
      <div class="container">
        <div class="row">
          <div class="span12">
            <div class="titulo-main">Explorando mercados campesinos registrados</div>
          </div>
        </div>
      </div> <!-- /container -->
    </section> 

    <section class="contenido">



      <div class="container">
        <div class="row">
          <div class="span2">
            <div class="sidebar-mapa">
              <a href="/mercado_mapa/" class="on">Toda Nicaragua</a>
              {% for departamento in dpto %}
                <a href="#" onclick="myMapa('{{departamento.id}}')">{{departamento}}</a>
              {% endfor %}
              <div class="clearfix"></div>
              <br>
            </div>
          </div>
          <div class="span10">
            <div class="mapa">
              <form class="form-inline" action="." method="POST">
                {%csrf_token%}
                <div class="selects">

                  {{form.tipo_organizacion_mercado}}
                  {{form.tipo_organizacion_mercado.errors}}
                  {{form.periodicidad}}
                  {{form.periodicidad.errors}}
                  {{form.productos_procesados}}
                  {{form.productos_procesados.errors}}
                  {{form.productos_frescos}}
                  {{form.productos_frescos.errors}}
                  
               </div>  
               <button type="submit" class="boton">Actualizar</button>
              </form>
              <div class="mapa-interno">

                <div id="map" style="width: 100%; height: 100%">
              </div>
            </div>
          </div>
        </div>
      </div> <!-- /container -->
    </section> 
{%endblock%}